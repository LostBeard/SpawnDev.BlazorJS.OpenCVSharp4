@page "/"
@using SpawnDev.BlazorJS.JSObjects
@using OpenCvSharp;

<PageTitle>Index</PageTitle>

<h1>OpenCVSharp4 Simple Demo</h1>

<canvas @ref=canvasSrcRef></canvas>
<br />
<canvas @ref=canvasDestRef></canvas>
<br />

@code {
    ElementReference canvasSrcRef;
    ElementReference canvasDestRef;
    string TestImage = "https://i.imgur.com/WOZagma.jpeg";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        if (firstRender)
        {
            using var canvasSrcEl = new HTMLCanvasElement(canvasSrcRef);
            using var canvasSrcCtx = canvasSrcEl.Get2DContext();
            using var canvasDestEl = new HTMLCanvasElement(canvasDestRef);
            using var canvasDestCtx = canvasDestEl.Get2DContext();
            using var src = new Mat();
            await src.LoadImageURL(TestImage);
            src.DrawOnCanvas(canvasSrcCtx, true);
            using var dst = new Mat();
            Cv2.Canny(src, dst, 50, 200);
            dst.DrawOnCanvas(canvasDestCtx, true);
        }
    }
}